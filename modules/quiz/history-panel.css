/* 历史记录操作栏 */
.history-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--btn-sec);
  opacity: 0.8;
  transition: opacity 0.2s ease;
}

.history-actions:hover {
  opacity: 1;
}

/* 历史记录统计 */
.history-stats {
  font-size: 12px;
  color: var(--sub);
  font-weight: 500;
}

#historyCount {
  color: var(--accent-color);
  font-weight: 600;
}

/* 清空按钮 */
.clear-history-btn {
  background: var(--danger-color, var(--accent-color, #f44336));
  color: var(--button-text, white) !important;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 6px;
  line-height: 1;
  min-height: 36px;
}

.clear-history-btn:disabled {
  background: var(--button-disabled-bg, var(--btn-sec, #e0e0e0));
  color: var(--button-disabled-text, var(--text-muted, #9e9e9e)) !important;
  cursor: not-allowed;
  opacity: 0.6;
  transform: none !important;
}

.clear-history-btn:not(:disabled):hover {
  background: var(--danger-hover, var(--accent-hover, #d32f2f));
  color: var(--button-text, white) !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.clear-history-btn:not(:disabled):active {
  background: var(--danger-active, var(--accent-active, #c62828));
  transform: translateY(0);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
}

/* 历史记录容器 */
.history-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-height: 215px;
  overflow-y: auto;
  padding: 4px 2px;
}

/* 历史记录项 - 三栏布局 */
.history-item {
  display: flex;
  background: var(--card);
  border: 1px solid var(--btn-sec);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  height: 65px; /* 增加高度 */
  min-height: 65px; /* 确保最小高度 */
  align-items: center;
  overflow: hidden;
  width: 100% !important;
  min-width: 100% !important;
  box-sizing: border-box !important;
}

.history-item:hover {
  border-color: var(--accent-color);
  transform: translateY(-1px);
  box-shadow: 0 2px 8px var(--shadow);
}

/* 选中状态 - 整个项边框高亮 */
.history-item.selected {
  border: 2px solid var(--accent-color);
  background: var(--card);
  transform: translateY(-1px);
}

/* 三栏布局 */
.history-section-left,
.history-section-middle,
.history-section-right {
  display: flex;
  align-items: center;
  justify-content: center;
  flex: 1;
  position: relative;
  min-height: 65px; /* 匹配父容器高度 */
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-sizing: border-box;
  min-width: 0; /* 防止内容溢出 */
}

/* 左右播放区域 */
.history-section-left,
.history-section-right {
  cursor: pointer;
  background: var(--card);
  margin: 0 !important; /* 移除负边距 */
  padding: 0; /* 移除内边距 */
  border-radius: 11px 0 0 11px; /* 左侧圆角 */
  position: relative;
  flex: 1;
  height: 100%;
  align-self: stretch;
}

.history-section-right {
  border-radius: 0 11px 11px 0; /* 右侧圆角 */
}

/* 中间区域保持不变 */
.history-section-middle {
  cursor: default;
  background: var(--card);
  margin: 0;
  z-index: 1; /* 确保在中间层 */
  flex: 0 0 auto; /* 根据内容自适应 */
  min-width: 60px; /* 给中间区域一个最小宽度 */
}

/* 耳机线控制按钮效果 */
.history-section-left::before,
.history-section-right::before {
  content: '';
  position: absolute;
  top: 50%;
  width: 3px;
  height: 20px;
  background: linear-gradient(135deg, var(--accent-color) 0%, color-mix(in srgb, var(--accent-color) 60%, transparent) 100%);
  border-radius: 2px;
  opacity: 0;
  transition: all 0.3s ease;
}

.history-section-left::before {
  left: 8px; /* 距离左侧边缘 */
  transform: translateY(-50%) rotate(0deg);
}

.history-section-right::before {
  right: 8px; /* 距离右侧边缘 */
  transform: translateY(-50%) rotate(0deg);
}

.history-section-left:hover::before,
.history-section-right:hover::before {
  opacity: 0.6;
}

/* 按压效果 - 扩展到整个区域 */
.history-item.playing-base .history-section-left,
.history-item.playing-target .history-section-right {
  background: rgba(244, 67, 54, 0.25) !important;
  transform: scale(0.98);
  box-shadow: 
    inset 0 4px 8px rgba(0, 0, 0, 0.15),
    inset 0 -2px 4px rgba(255, 255, 255, 0.2),
    0 0 0 2px rgba(244, 67, 54, 0.3);
  animation: enhancedButtonPress 0.3s ease forwards;
  
  /* 扩展到整个区域 */
  height: 100% !important;
  min-height: 100% !important;
  align-self: stretch !important;
  position: relative;
  z-index: 1;
}

/* 增强版按压动画 */
@keyframes enhancedButtonPress {
  0% {
    transform: scale(1);
    background: var(--card);
    box-shadow: none;
  }
  50% {
    transform: scale(0.98);
    background: rgba(244, 67, 54, 0.3) !important;
    box-shadow: 
      inset 0 4px 8px rgba(0, 0, 0, 0.2),
      inset 0 -2px 4px rgba(255, 255, 255, 0.3),
      0 0 0 3px rgba(244, 67, 54, 0.4);
  }
  100% {
    transform: scale(0.98);
    background: rgba(244, 67, 54, 0.25) !important;
    box-shadow: 
      inset 0 2px 4px rgba(0, 0, 0, 0.1),
      inset 0 -1px 2px rgba(255, 255, 255, 0.2),
      0 0 0 2px rgba(244, 67, 54, 0.3);
  }
}

/* 特别处理左侧按压圆角 */
.history-item.playing-base .history-section-left {
  border-radius: 11px 0 0 11px !important;
}

/* 特别处理右侧按压圆角 */
.history-item.playing-target .history-section-right {
  border-radius: 0 11px 11px 0 !important;
}

/* 确保按压时内容仍然居中 */
.history-item.playing-base .history-section-left .solfeggio-name,
.history-item.playing-target .history-section-right .solfeggio-name {
  position: relative;
  z-index: 2;
}

/* 播放时控制线高亮 */
.history-item.playing-base .history-section-left::before,
.history-item.playing-target .history-section-right::before {
  opacity: 1;
  height: 24px;
  background: linear-gradient(135deg, var(--accent-color) 0%, color-mix(in srgb, var(--accent-color) 40%, white) 100%);
  box-shadow: 0 0 8px var(--accent-color);
}

/* 唱名显示 */
.solfeggio-name {
  font-size: 16px;
  font-weight: 600;
  color: var(--text);
  text-align: center;
  line-height: 1.2;
  transition: all 0.3s ease;
  margin: 0;
  padding: 0;
}

.key-info {
  font-size: 15px;
  color: var(--sub);
  font-weight: 500;
  text-align: center;
  line-height: 1.2;
  margin: 0;
  padding: 0;
}

/* 播放时的文字效果 */
.history-item.playing-base .history-section-left .solfeggio-name,
.history-item.playing-target .history-section-right .solfeggio-name {
  color: var(--accent-color) !important;
  font-weight: 700;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Unicode 细竖线 */
.history-section-middle::before,
.history-section-middle::after {
  content: '|';
  position: absolute;
  top: 20%;
  bottom: 20%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  color: color-mix(in srgb, var(--btn-sec) 60%, transparent);
  opacity: 0.7;
  font-weight: 200;
  line-height: 1;
}

.history-section-middle::before {
  left: -5px;
}

.history-section-middle::after {
  right: -5px;
}

/* 播放指示器图标 */
.history-section-left::after,
.history-section-right::after {
  content: '♪';
  position: absolute;
  font-size: 10px;
  color: var(--accent-color);
  opacity: 0;
  transition: all 0.3s ease;
  background: var(--card);
  border-radius: 50%;
  width: 14px;
  height: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  border: 1px solid var(--btn-sec);
}

.history-section-left::after {
  right: 8px;
}

.history-section-right::after {
  left: 8px;
}

.history-section-left:hover::after,
.history-section-right:hover::after {
  opacity: 0.8;
}

/* 播放时图标动画 */
.history-item.playing-base .history-section-left::after,
.history-item.playing-target .history-section-right::after {
  opacity: 1;
  animation: noteGlow 1.5s ease-in-out infinite;
  background: var(--accent-color);
  color: white;
  border-color: var(--accent-color);
}

@keyframes noteGlow {
  0%, 100% {
    box-shadow: 0 0 4px var(--accent-color);
  }
  50% {
    box-shadow: 0 0 8px var(--accent-color), 0 0 12px color-mix(in srgb, var(--accent-color) 50%, transparent);
  }
}

/* 空状态 */
.history-empty {
  text-align: center;
  color: var(--sub);
  font-size: 14px;
  padding: 20px;
  font-style: italic;
}

/* 滚动条样式 */
.history-list::-webkit-scrollbar {
  width: 4px;
}

.history-list::-webkit-scrollbar-track {
  background: var(--btn-sec);
  border-radius: 2px;
}

.history-list::-webkit-scrollbar-thumb {
  background: var(--accent-color);
  border-radius: 2px;
}

.history-list::-webkit-scrollbar-thumb:hover {
  background: color-mix(in srgb, var(--accent-color) 80%, black);
}

/* =========================
   移动端适配
========================= */

@media (max-width: 768px) {
  /* 操作栏 */
  .history-actions {
    margin-top: 10px;
    padding-top: 10px;
  }
  
  .history-stats {
    font-size: 11px;
  }
  
  .clear-history-btn {
    font-size: 11px;
    padding: 3px 10px;
  }

  /* 历史记录容器 */
  .history-list {
    max-height: 200px;
    gap: 6px;
  }
  
  /* 历史记录项 */
  .history-item {
    height: 55px;
    min-height: 55px;
  }
  
  /* 左右区域适配 */
  .history-section-left,
  .history-section-right,
  .history-section-middle {
    min-height: 55px;
  }
  
  /* 移除移动端的有问题的样式 */
  .history-section-left,
  .history-section-right {
    margin: 0 !important;
    padding: 0;
  }
  
  .solfeggio-name {
    font-size: 14px;
  }
  
  .key-info {
    font-size: 11px;
  }

  /* 耳机线控制按钮适配 */
  .history-section-left::before,
  .history-section-right::before {
    width: 2px;
    height: 16px;
  }
  
  .history-section-left::before {
    left: 6px;
  }
  
  .history-section-right::before {
    right: 6px;
  }
  
  .history-item.playing-base .history-section-left::before,
  .history-item.playing-target .history-section-right::before {
    height: 20px;
  }

  /* 播放图标适配 */
  .history-section-left::after,
  .history-section-right::after {
    width: 12px;
    height: 12px;
    font-size: 9px;
  }

  .history-section-left::after {
    right: 6px;
  }
  
  .history-section-right::after {
    left: 6px;
  }

  /* 移动端按压效果 */
  .history-item.playing-base .history-section-left,
  .history-item.playing-target .history-section-right {
    height: 100% !important;
    min-height: 100% !important;
    align-self: stretch !important;
  }
}

/* =========================
   深色主题优化
========================= */

@media (prefers-color-scheme: dark) {
  .history-item {
    border-color: color-mix(in srgb, var(--btn-sec) 60%, transparent);
  }

  /* 按压效果深色主题优化 */
  .history-item.playing-base .history-section-left,
  .history-item.playing-target .history-section-right {
    background: rgba(244, 67, 54, 0.3) !important; /* 深色主题用30%透明度 */
    box-shadow: 
      inset 0 2px 6px rgba(0, 0, 0, 0.3),
      inset 0 -1px 2px rgba(255, 255, 255, 0.1);
  }

  /* 控制线深色主题 */
  .history-item.playing-base .history-section-left::before,
  .history-item.playing-target .history-section-right::before {
    background: linear-gradient(135deg, var(--accent-color) 0%, color-mix(in srgb, var(--accent-color) 70%, white) 100%);
    box-shadow: 0 0 12px var(--accent-color);
  }

  /* 播放图标深色主题 */
  .history-section-left::after,
  .history-section-right::after {
    background: var(--card);
    border-color: color-mix(in srgb, var(--btn-sec) 60%, transparent);
  }
  
  .history-item.playing-base .history-section-left::after,
  .history-item.playing-target .history-section-right::after {
    background: var(--accent-color);
    border-color: var(--accent-color);
  }
}