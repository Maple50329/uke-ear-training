/* å†å²è®°å½•æ“ä½œæ  */
.history-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--btn-sec);
  opacity: 0.8;
  transition: opacity 0.2s ease;
}

.history-actions:hover {
  opacity: 1;
}

/* å†å²è®°å½•ç»Ÿè®¡ */
.history-stats {
  font-size: 12px;
  color: var(--sub);
  font-weight: 500;
}

#historyCount {
  color: var(--accent-color);
  font-weight: 600;
}

/* æ¸…ç©ºæŒ‰é’® */
.clear-history-btn {
  background: var(--danger-color, var(--accent-color, #f44336));
  color: var(--button-text, white) !important;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 6px;
  line-height: 1;
  min-height: 36px;
}

.clear-history-btn:disabled {
  background: var(--button-disabled-bg, var(--btn-sec, #e0e0e0));
  color: var(--button-disabled-text, var(--text-muted, #9e9e9e)) !important;
  cursor: not-allowed;
  opacity: 0.6;
  transform: none !important;
}

.clear-history-btn:not(:disabled):hover {
  background: var(--danger-hover, var(--accent-hover, #d32f2f));
  color: var(--button-text, white) !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.clear-history-btn:not(:disabled):active {
  background: var(--danger-active, var(--accent-active, #c62828));
  transform: translateY(0);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
}

/* å†å²è®°å½•å®¹å™¨ */
.history-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-height: 215px;
  overflow-y: auto;
  padding: 4px 2px;
}

/* å†å²è®°å½•é¡¹ - ä¸‰æ å¸ƒå±€ */
.history-item {
  display: flex;
  background: var(--card);
  border: 1px solid var(--btn-sec);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  height: 65px; /* å¢åŠ é«˜åº¦ */
  min-height: 65px; /* ç¡®ä¿æœ€å°é«˜åº¦ */
  align-items: center;
  overflow: hidden;
  width: 100% !important;
  min-width: 100% !important;
  box-sizing: border-box !important;
}

.history-item:hover {
  border-color: var(--accent-color);
  transform: translateY(-1px);
  box-shadow: 0 2px 8px var(--shadow);
}

/* é€‰ä¸­çŠ¶æ€ - æ•´ä¸ªé¡¹è¾¹æ¡†é«˜äº® */
.history-item.selected {
  border-color: rgba(var(--accent-rgb), 0.7);
  box-shadow:
    0 2px 8px rgba(0, 0, 0, 0.45),
    0 0 0 1px rgba(var(--accent-rgb), 0.5);
  transform: translateY(-1px) scale(1.01);
}

/* ä¸‰æ å¸ƒå±€ */
.history-section-left,
.history-section-middle,
.history-section-right {
  display: flex;
  align-items: center;
  justify-content: center;
  flex: 1;
  position: relative;
  min-height: 65px; /* åŒ¹é…çˆ¶å®¹å™¨é«˜åº¦ */
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-sizing: border-box;
  min-width: 0; /* é˜²æ­¢å†…å®¹æº¢å‡º */
}

/* å·¦å³æ’­æ”¾åŒºåŸŸ */
.history-section-left,
.history-section-right {
  cursor: pointer;
  background: var(--card);
  margin: 0 !important; /* ç§»é™¤è´Ÿè¾¹è· */
  padding: 0; /* ç§»é™¤å†…è¾¹è· */
  border-radius: 11px 0 0 11px; /* å·¦ä¾§åœ†è§’ */
  position: relative;
  flex: 1;
  height: 100%;
  align-self: stretch;
}

.history-section-right {
  border-radius: 0 11px 11px 0; /* å³ä¾§åœ†è§’ */
}

/* ä¸­é—´åŒºåŸŸä¿æŒä¸å˜ */
.history-section-middle {
  cursor: default;
  background: var(--card);
  margin: 0;
  z-index: 1; /* ç¡®ä¿åœ¨ä¸­é—´å±‚ */
  flex: 0 0 auto; /* æ ¹æ®å†…å®¹è‡ªé€‚åº” */
  min-width: 60px; /* ç»™ä¸­é—´åŒºåŸŸä¸€ä¸ªæœ€å°å®½åº¦ */
}

/* è€³æœºçº¿æ§åˆ¶æŒ‰é’®æ•ˆæœ */
.history-section-left::before,
.history-section-right::before {
  content: '';
  position: absolute;
  top: 50%;
  width: 3px;
  height: 20px;
  background: linear-gradient(135deg, var(--accent-color) 0%, color-mix(in srgb, var(--accent-color) 60%, transparent) 100%);
  border-radius: 2px;
  opacity: 0;
  transition: all 0.3s ease;
}

.history-section-left::before {
  left: 8px; /* è·ç¦»å·¦ä¾§è¾¹ç¼˜ */
  transform: translateY(-50%) rotate(0deg);
}

.history-section-right::before {
  right: 8px; /* è·ç¦»å³ä¾§è¾¹ç¼˜ */
  transform: translateY(-50%) rotate(0deg);
}

.history-section-left:hover::before,
.history-section-right:hover::before {
  opacity: 0.6;
}

/* æŒ‰å‹æ•ˆæœ - æ‰©å±•åˆ°æ•´ä¸ªåŒºåŸŸ */
.history-item.playing-base .history-section-left,
.history-item.playing-target .history-section-right {
  background: rgba(244, 67, 54, 0.25) !important;
  transform: scale(0.98);
  box-shadow: 
    inset 0 4px 8px rgba(0, 0, 0, 0.15),
    inset 0 -2px 4px rgba(255, 255, 255, 0.2),
    0 0 0 2px rgba(244, 67, 54, 0.3);
  animation: enhancedButtonPress 0.3s ease forwards;
  
  /* æ‰©å±•åˆ°æ•´ä¸ªåŒºåŸŸ */
  height: 100% !important;
  min-height: 100% !important;
  align-self: stretch !important;
  position: relative;
  z-index: 1;
}

/* å¢å¼ºç‰ˆæŒ‰å‹åŠ¨ç”» */
@keyframes enhancedButtonPress {
  0% {
    transform: scale(1);
    background: var(--card);
    box-shadow: none;
  }
  50% {
    transform: scale(0.98);
    background: rgba(244, 67, 54, 0.3) !important;
    box-shadow: 
      inset 0 4px 8px rgba(0, 0, 0, 0.2),
      inset 0 -2px 4px rgba(255, 255, 255, 0.3),
      0 0 0 3px rgba(244, 67, 54, 0.4);
  }
  100% {
    transform: scale(0.98);
    background: rgba(244, 67, 54, 0.25) !important;
    box-shadow: 
      inset 0 2px 4px rgba(0, 0, 0, 0.1),
      inset 0 -1px 2px rgba(255, 255, 255, 0.2),
      0 0 0 2px rgba(244, 67, 54, 0.3);
  }
}

/* ç‰¹åˆ«å¤„ç†å·¦ä¾§æŒ‰å‹åœ†è§’ */
.history-item.playing-base .history-section-left {
  border-radius: 11px 0 0 11px !important;
}

/* ç‰¹åˆ«å¤„ç†å³ä¾§æŒ‰å‹åœ†è§’ */
.history-item.playing-target .history-section-right {
  border-radius: 0 11px 11px 0 !important;
}

/* ç¡®ä¿æŒ‰å‹æ—¶å†…å®¹ä»ç„¶å±…ä¸­ */
.history-item.playing-base .history-section-left .solfeggio-name,
.history-item.playing-target .history-section-right .solfeggio-name {
  position: relative;
  z-index: 2;
}

/* æ’­æ”¾æ—¶æ§åˆ¶çº¿é«˜äº® */
.history-item.playing-base .history-section-left::before,
.history-item.playing-target .history-section-right::before {
  opacity: 1;
  height: 24px;
  background: linear-gradient(135deg, var(--accent-color) 0%, color-mix(in srgb, var(--accent-color) 40%, white) 100%);
  box-shadow: 0 0 8px var(--accent-color);
}

/* å”±åæ˜¾ç¤º */
.solfeggio-name {
  font-size: 16px;
  font-weight: 600;
  color: var(--text);
  text-align: center;
  line-height: 1.2;
  transition: all 0.3s ease;
  margin: 0;
  padding: 0;
  display: flex;               /* âœ… å‚ç›´å±…ä¸­åŸºå‡†éŸ³/ç›®æ ‡éŸ³ */
  align-items: center;
  justify-content: center;
}

.key-info {
  font-size: 15px;
  color: var(--sub);
  font-weight: 500;
  text-align: center;
  line-height: 1.2;
  margin: 0;
  padding: 0;
  display: inline-flex;         /* âœ… è°ƒæ€§ + å¾½æ ‡ä¸€è¡Œæ°´å¹³å±…ä¸­ */
  align-items: center;
  justify-content: center;
  gap: 6px;                     /* è°ƒæ€§æ–‡å­—å’Œå¾½æ ‡ä¹‹é—´ç•™ä¸€ç‚¹é—´è· */
}

/* è°ƒæ€§æ–‡å­—æœ¬èº«ä¸æ¢è¡Œï¼Œé˜²æ­¢è¢«å¾½æ ‡æŒ¤æ‰ */
.key-text {
  white-space: nowrap;
}

/* é¦–å‡»æ­£ç¡®å¾½æ ‡ */
.history-badge {
  display: inline-flex;
  align-items: center;
  padding: 1px 6px;
  border-radius: 999px;
  font-size: 11px;
  line-height: 1.2;
  white-space: nowrap;
  border: 1px solid transparent;
}

.history-badge.first-try {
  background: rgba(34, 197, 94, 0.10);      /* ç»¿è‰²æ·¡åº• */
  color: #16a34a;
  border-color: rgba(22, 163, 74, 0.4);
}

/* æ•´æ¡é¦–å‡»è®°å½•ç¨å¾®é«˜äº®ä¸€ç‚¹ï¼ˆå¯é€‰ï¼Œä¸å–œæ¬¢å¯ä»¥åˆ æ‰è¿™ä¸€æ®µï¼‰ */
.history-item.first-try {
  border-left: 4px solid #16a34a;
  background: rgba(16, 185, 129, 0.04);
}

@media (prefers-color-scheme: dark) {
  .history-item.first-try {
    background: linear-gradient(
      90deg,
      rgba(34, 197, 94, 0.25),
      rgba(34, 197, 94, 0.10),
      transparent
    );
  }

  .history-item.multi-try {
    background: linear-gradient(
      90deg,
      rgba(249, 115, 22, 0.26),
      rgba(249, 115, 22, 0.12),
      transparent
    );
  }

  .history-item.system-reveal {
    background: linear-gradient(
      90deg,
      rgba(248, 113, 113, 0.3),
      rgba(248, 113, 113, 0.14),
      transparent
    );
  }
}

/* æ’­æ”¾æ—¶çš„æ–‡å­—æ•ˆæœ */
.history-item.playing-base .history-section-left .solfeggio-name,
.history-item.playing-target .history-section-right .solfeggio-name {
  color: var(--accent-color) !important;
  font-weight: 700;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Unicode ç»†ç«–çº¿ */
.history-section-middle::before,
.history-section-middle::after {
  content: '|';
  position: absolute;
  top: 20%;
  bottom: 20%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  color: color-mix(in srgb, var(--btn-sec) 60%, transparent);
  opacity: 0.7;
  font-weight: 200;
  line-height: 1;
}

.history-section-middle::before {
  left: -5px;
}

.history-section-middle::after {
  right: -5px;
}

/* ============================
   å†å²è®°å½• - ä¸‰ç§è¡¨ç°ç±»å‹é…è‰²
   first-try      ğŸŸ© é¦–å‡»æ­£ç¡®
   multi-try      ğŸŸ§ å¤šæ¬¡å°è¯•åç­”å¯¹
   system-reveal  ğŸŸ¥ ç³»ç»Ÿæ­æ™“
============================= */

.history-item.first-try,
.history-item.multi-try,
.history-item.system-reveal {
  border-left: 4px solid transparent;
  padding-left: 8px;
}

/* ğŸŸ© é¦–å‡»æ­£ç¡®ï¼šåè–„è·çš„ç»¿ */
.history-item.first-try {
  border-left-color: #4ade80; /* tailwind çš„é‚£ç§å«©ç»¿ */
  background: linear-gradient(
    90deg,
    rgba(34, 197, 94, 0.15),
    rgba(34, 197, 94, 0.05),
    transparent
  );
}

/* ğŸŸ§ å¤šæ¬¡åæ­£ç¡®ï¼šåç¥ç€æ©™ */
.history-item.multi-try {
  border-left-color: #fb923c;
  background: linear-gradient(
    90deg,
    rgba(249, 115, 22, 0.16),
    rgba(249, 115, 22, 0.06),
    transparent
  );
}

/* ğŸŸ¥ ç³»ç»Ÿæ­æ™“ï¼šåçŠç‘šçº¢ */
.history-item.system-reveal {
  border-left-color: #f97373;
  background: linear-gradient(
    90deg,
    rgba(248, 113, 113, 0.18),
    rgba(248, 113, 113, 0.07),
    transparent
  );
}


/* æ·±è‰²æ¨¡å¼ç¨å¾®åŠ ç‚¹äº®åº¦ */
body.dark .history-item.first-try {
  background: rgba(16, 185, 129, 0.12);
}
body.dark .history-item.multi-try {
  background: rgba(249, 115, 22, 0.12);
}
body.dark .history-item.system-reveal {
  background: rgba(220, 38, 38, 0.12);
}

/* ============================
   é¦–å‡»æ­£ç¡®å¾½æ ‡æ ·å¼
============================ */
.history-badge.first-try-badge {
  display: inline-flex;
  align-items: center;
  padding: 1px 6px;
  border-radius: 999px;
  font-size: 11px;
  line-height: 1.2;
  white-space: nowrap;

  background: rgba(34, 197, 94, 0.15);   /* æ·¡ç»¿è‰²åº• */
  color: #16a34a;                        /* å­—ä½“ç»¿è‰² */
  border: 1px solid rgba(22, 163, 74, 0.35);
}

/* æš—è‰²æ¨¡å¼ç¨äº®ä¸€ç‚¹ */
body.dark .history-badge.first-try-badge {
  background: rgba(34, 197, 94, 0.25);
}

/* æ’­æ”¾æŒ‡ç¤ºå™¨å›¾æ ‡ */
.history-section-left::after,
.history-section-right::after {
  content: 'â™ª';
  position: absolute;
  font-size: 10px;
  color: var(--accent-color);
  opacity: 0;
  transition: all 0.3s ease;
  background: var(--card);
  border-radius: 50%;
  width: 14px;
  height: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  border: 1px solid var(--btn-sec);
}

.history-section-left::after {
  right: 8px;
}

.history-section-right::after {
  left: 8px;
}

.history-section-left:hover::after,
.history-section-right:hover::after {
  opacity: 0.8;
}

/* æ’­æ”¾æ—¶å›¾æ ‡åŠ¨ç”» */
.history-item.playing-base .history-section-left::after,
.history-item.playing-target .history-section-right::after {
  opacity: 1;
  animation: noteGlow 1.5s ease-in-out infinite;
  background: var(--accent-color);
  color: white;
  border-color: var(--accent-color);
}

@keyframes noteGlow {
  0%, 100% {
    box-shadow: 0 0 4px var(--accent-color);
  }
  50% {
    box-shadow: 0 0 8px var(--accent-color), 0 0 12px color-mix(in srgb, var(--accent-color) 50%, transparent);
  }
}

/* ç©ºçŠ¶æ€ */
.history-empty {
  text-align: center;
  color: var(--sub);
  font-size: 14px;
  padding: 20px;
  font-style: italic;
}

/* æ»šåŠ¨æ¡æ ·å¼ */
.history-list::-webkit-scrollbar {
  width: 4px;
}

.history-list::-webkit-scrollbar-track {
  background: var(--btn-sec);
  border-radius: 2px;
}

.history-list::-webkit-scrollbar-thumb {
  background: var(--accent-color);
  border-radius: 2px;
}

.history-list::-webkit-scrollbar-thumb:hover {
  background: color-mix(in srgb, var(--accent-color) 80%, black);
}

/* =========================
   ç§»åŠ¨ç«¯é€‚é…
========================= */

@media (max-width: 768px) {
  /* æ“ä½œæ  */
  .history-actions {
    margin-top: 10px;
    padding-top: 10px;
  }
  
  .history-stats {
    font-size: 11px;
  }
  
  .clear-history-btn {
    font-size: 11px;
    padding: 3px 10px;
  }

  /* å†å²è®°å½•å®¹å™¨ */
  .history-list {
    max-height: 200px;
    gap: 6px;
  }
  
  /* å†å²è®°å½•é¡¹ */
  .history-item {
    height: 55px;
    min-height: 55px;
  }
  
  /* å·¦å³åŒºåŸŸé€‚é… */
  .history-section-left,
  .history-section-right,
  .history-section-middle {
    min-height: 55px;
  }
  
  /* ç§»é™¤ç§»åŠ¨ç«¯çš„æœ‰é—®é¢˜çš„æ ·å¼ */
  .history-section-left,
  .history-section-right {
    margin: 0 !important;
    padding: 0;
  }
  
  .solfeggio-name {
    font-size: 14px;
  }
  
  .key-info {
    font-size: 11px;
  }

  /* è€³æœºçº¿æ§åˆ¶æŒ‰é’®é€‚é… */
  .history-section-left::before,
  .history-section-right::before {
    width: 2px;
    height: 16px;
  }
  
  .history-section-left::before {
    left: 6px;
  }
  
  .history-section-right::before {
    right: 6px;
  }
  
  .history-item.playing-base .history-section-left::before,
  .history-item.playing-target .history-section-right::before {
    height: 20px;
  }

  /* æ’­æ”¾å›¾æ ‡é€‚é… */
  .history-section-left::after,
  .history-section-right::after {
    width: 12px;
    height: 12px;
    font-size: 9px;
  }

  .history-section-left::after {
    right: 6px;
  }
  
  .history-section-right::after {
    left: 6px;
  }

  /* ç§»åŠ¨ç«¯æŒ‰å‹æ•ˆæœ */
  .history-item.playing-base .history-section-left,
  .history-item.playing-target .history-section-right {
    height: 100% !important;
    min-height: 100% !important;
    align-self: stretch !important;
  }
}

/* =========================
   æ·±è‰²ä¸»é¢˜ä¼˜åŒ–
========================= */

@media (prefers-color-scheme: dark) {
  .history-item {
    border-color: color-mix(in srgb, var(--btn-sec) 60%, transparent);
  }

  /* æŒ‰å‹æ•ˆæœæ·±è‰²ä¸»é¢˜ä¼˜åŒ– */
  .history-item.playing-base .history-section-left,
  .history-item.playing-target .history-section-right {
    background: rgba(244, 67, 54, 0.3) !important; /* æ·±è‰²ä¸»é¢˜ç”¨30%é€æ˜åº¦ */
    box-shadow: 
      inset 0 2px 6px rgba(0, 0, 0, 0.3),
      inset 0 -1px 2px rgba(255, 255, 255, 0.1);
  }

  /* æ§åˆ¶çº¿æ·±è‰²ä¸»é¢˜ */
  .history-item.playing-base .history-section-left::before,
  .history-item.playing-target .history-section-right::before {
    background: linear-gradient(135deg, var(--accent-color) 0%, color-mix(in srgb, var(--accent-color) 70%, white) 100%);
    box-shadow: 0 0 12px var(--accent-color);
  }

  /* æ’­æ”¾å›¾æ ‡æ·±è‰²ä¸»é¢˜ */
  .history-section-left::after,
  .history-section-right::after {
    background: var(--card);
    border-color: color-mix(in srgb, var(--btn-sec) 60%, transparent);
  }
  
  .history-item.playing-base .history-section-left::after,
  .history-item.playing-target .history-section-right::after {
    background: var(--accent-color);
    border-color: var(--accent-color);
  }
}

